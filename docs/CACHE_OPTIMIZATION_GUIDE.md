# –°–∏—Å—Ç–µ–º–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## üìã –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞ AnotherWoW:

### üîß –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

1. **CacheService** - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
2. **OptimizedDatabaseConnection** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
3. **CachedModel** - –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
4. **CachedAccountCoins** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–Ω–µ—Ç–∞–º–∏
5. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ TTL –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
src/services/
‚îú‚îÄ‚îÄ CacheService.php              # –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ OptimizedDatabaseConnection.php # –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ DB –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ CachedModel.php               # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π

src/models/
‚îú‚îÄ‚îÄ CachedAccountCoins.php        # –ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –º–æ–Ω–µ—Ç

config/
‚îú‚îÄ‚îÄ cache.php                     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

–£—Ç–∏–ª–∏—Ç—ã:
‚îú‚îÄ‚îÄ cache_monitor.php             # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ cache_cleanup.php             # –û—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ –∫–µ—à–∞  
‚îú‚îÄ‚îÄ test_cache_performance.php    # –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

```php
$cache = CacheService::getInstance();

// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫–µ—à
$cache->set('user_data_123', $userData, 600); // 10 –º–∏–Ω—É—Ç TTL

// –ü–æ–ª—É—á–∏—Ç—å –∏–∑ –∫–µ—à–∞
$userData = $cache->get('user_data_123', 600);

// –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ñ—É–Ω–∫—Ü–∏–µ–π –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞
$data = $cache->remember('expensive_calculation', function() {
    return performExpensiveCalculation();
}, 1800); // 30 –º–∏–Ω—É—Ç
```

### –ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î

```php
// –ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–µ—à–∏—Ä—É–µ—Ç—Å—è –Ω–∞ 5 –º–∏–Ω—É—Ç)
$results = OptimizedDatabaseConnection::cachedQuery(
    $connection,
    "SELECT * FROM users WHERE status = ?",
    ['active'],
    600  // TTL –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
);

// –ó–∞–ø—Ä–æ—Å —Å –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∫–µ—à–∞
OptimizedDatabaseConnection::executeWithCacheInvalidation(
    $connection,
    "INSERT INTO users (name, email) VALUES (?, ?)",
    ['John', 'john@example.com'],
    ['users'] // —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏
);
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π

```php
$coinsModel = new CachedAccountCoins($connection);

// –í—Å–µ –º–µ—Ç–æ–¥—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
$balance = $coinsModel->getBalance($accountId);       // –ö–µ—à –Ω–∞ 10 –º–∏–Ω—É—Ç
$history = $coinsModel->getHistory($accountId, 20);   // –ö–µ—à –Ω–∞ 5 –º–∏–Ω—É—Ç
$topUsers = $coinsModel->getTopUsers(10);             // –ö–µ—à –Ω–∞ 30 –º–∏–Ω—É—Ç

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∫–µ—à–∞
$coinsModel->add($accountId, 5, '–ù–∞–≥—Ä–∞–¥–∞ –∑–∞ –∫–≤–µ—Å—Ç');
```

### –ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –æ—Ç CachedModel

```php
class CachedNews extends CachedModel
{
    public function __construct($db) 
    {
        parent::__construct($db, 'news');
        $this->setCacheTtl(1800); // 30 –º–∏–Ω—É—Ç –¥–ª—è –Ω–æ–≤–æ—Å—Ç–µ–π
    }
    
    public function getLatestNews($limit = 10): array
    {
        return $this->getAllCached('news', 
            ['published' => 1], 
            'created_at DESC', 
            $limit,
            $this->getTtlForType('news_list')
        );
    }
    
    public function getNewsById($id): ?array
    {
        return $this->findCached('news', $id);
    }
}
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `config/cache.php`:

```php
return [
    'default_ttl' => 300,  // 5 –º–∏–Ω—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    
    'ttl' => [
        'user_balance' => 300,     // 5 –º–∏–Ω—É—Ç –¥–ª—è –±–∞–ª–∞–Ω—Å–∞
        'top_users' => 1800,       // 30 –º–∏–Ω—É—Ç –¥–ª—è —Ç–æ–ø–æ–≤
        'server_stats' => 3600,    // 1 —á–∞—Å –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    ],
    
    'cleanup' => [
        'auto_cleanup' => true,        // –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞
        'cleanup_probability' => 10,   // 10% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—á–∏—Å—Ç–∫–∏
        'max_file_age_hours' => 24,    // –£–¥–∞–ª—è—Ç—å —Ñ–∞–π–ª—ã —Å—Ç–∞—Ä—à–µ 24 —á–∞—Å–æ–≤
    ],
];
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

–û—Ç–∫—Ä–æ–π—Ç–µ `scripts/maintenance/cache_monitor.php` –≤ –±—Ä–∞—É–∑–µ—Ä–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–µ—à–∞ (—Ä–∞–∑–º–µ—Ä, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î  
- –¢–µ—Å—Ç–æ–≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–µ—à–µ–º

### –ö–æ–º–∞–Ω–¥—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```bash
# –û—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ –∫–µ—à–∞
php scripts/maintenance/cache_cleanup.php

# –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
php scripts/tests/test_cache_performance.php
```

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```php
// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–µ—à–∞
$stats = CacheService::getInstance()->getStats();
echo "–§–∞–π–ª–æ–≤ –∫–µ—à–∞: {$stats['total_files']}\n";
echo "–†–∞–∑–º–µ—Ä: {$stats['total_size_mb']} MB\n";

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
$queryStats = OptimizedDatabaseConnection::getQueryStats();
echo "–ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–π: {$queryStats['hit_ratio_percent']}%\n";
```

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

### Cron –∑–∞–¥–∞—á–∏

–î–æ–±–∞–≤—å—Ç–µ –≤ crontab –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏:

```bash
# –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
*/30 * * * * /usr/bin/php /path/to/project/scripts/maintenance/cache_cleanup.php

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫–∞–∂–¥—ã–π —á–∞—Å  
0 * * * * /usr/bin/php /path/to/project/scripts/tests/test_cache_performance.php >> /var/log/cache_performance.log
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ:
- `router.php` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `CachedAccountCoins`
- `CabinetController` - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –±–∞–ª–∞–Ω—Å–∞
- `VoteService` - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ mmotop —Ñ–∞–π–ª–æ–≤
- `bootstrap.php` - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

## üìà –û–∂–∏–¥–∞–µ–º–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–ü—Ä–æ—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã**: —É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 10-50x –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –∏–∑ –∫–µ—à–∞
- **–°–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã**: —É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 5-20x  
- **–ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: —É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 20-100x
- **–°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ë–î**: –¥–æ 80-90% –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–∏

## üîß Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–µ—à –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
```php
// –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –≤–∫–ª—é—á–µ–Ω–æ –ª–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
$cache = CacheService::getInstance();
if (!$cache->isEnabled()) {
    echo "–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö";
}
```

### –ü—Ä–æ–±–ª–µ–º–∞: –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ
```php
// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è
$cache->delete('specific_cache_key');

// –ò–ª–∏ –ø–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
$cache->clear();
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä –∫–µ—à–∞
```php
// –£–º–µ–Ω—å—à–∏—Ç–µ TTL –≤ config/cache.php –∏–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∫—É
php cache_cleanup.php
```

## üéØ –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

1. **TTL**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ—Ä–æ—Ç–∫–∏–µ TTL (5-10 –º–∏–Ω) –¥–ª—è —á–∞—Å—Ç–æ –∏–∑–º–µ–Ω—è—é—â–∏—Ö—Å—è –¥–∞–Ω–Ω—ã—Ö
2. **–ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è**: –í—Å–µ–≥–¥–∞ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ –∫–µ—à –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ hit ratio (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å > 70%)
4. **–û—á–∏—Å—Ç–∫–∞**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ –∫–µ—à–∞
5. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `test_cache_performance.php` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

## üìã –ß–µ–∫-–ª–∏—Å—Ç –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

- [x] –£—Å—Ç–∞–Ω–æ–≤–∫–∞ CacheService –∏ OptimizedDatabaseConnection
- [x] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ bootstrap.php –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤  
- [x] –ó–∞–º–µ–Ω–∞ AccountCoins –Ω–∞ CachedAccountCoins –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö
- [x] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- [x] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cron –∑–∞–¥–∞—á –¥–ª—è –æ—á–∏—Å—Ç–∫–∏
- [x] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ production —Å—Ä–µ–¥–µ
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è TTL –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ –¥–æ–ª–∂–Ω–∞ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞!