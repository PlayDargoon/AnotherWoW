<?php

class ProgressionController
{
    public function index(): void
    {
        // Встроенные данные прогрессии
        $intro = [
            'Испытайте World of Warcraft как никогда раньше на нашем уникальном сервере с постепенным прогрессом! Начиная с контента Классики, рейды и подземелья будут открываться один за другим по мере того, как игроки преодолевают испытания. Как только величайшие герои Азерота докажут свою силу, дополнения Пылающий Крестовый Поход и Гнев Короля-лича пойдут тем же путём, обеспечивая эпическое путешествие с постепенным прогрессом, вызовами и достижениями.'
        ];

        $phases = [
            [ 'number' => 1, 'title' => 'Классика', 'lines' => [
                'Приключение начинается! На этом этапе доступны только подземелья Классики, предоставляя авантюристам идеальную возможность повысить уровень и подготовиться к будущим испытаниям. От огненных глубин Чёрной горы до проклятых залов Сколоманс — каждое подземелье предлагает уникальных врагов, эпическую добычу и захватывающие сражения.',
                '- Огненная пропасть (13–18) — под Оргриммаром, культисты Клинка Бури.',
                '- Мёртвые копи (17–26) — Братство Справедливости, Эдвин ВанКлиф.',
                '- Пещеры Стенаний (15–25) — друиды Клыка, пещеры Степей.',
                '- Крепость Тёмного Клыка (22–30) — воргены и тёмная магия.',
                '- Непроглядная Пучина (22–32) — древний храм, наги и порча.',
                '- Тюрьма (24–32) — тюрьма Штормграда, бунт заключённых.',
                '- Гномреган (29–38) — радиоактивный город гномов, трогги и мутанты.',
                '- Лабиринты Иглошкурых (30–40) — логово квилбоаров.',
                '- Монастырь Алого ордена (26–45) — 4 крыла.',
                '- Курганы Иглошкурых (40–50) — нежить, культ «Головы Смерти».',
                '- Ульдаман (42–52) — тайны титанов.',
                '- Зул\'Фаррак (42–50) — город троллей в Танарисе.',
                '- Мародон (45–55) — святилища кентавров (оранж./фиолет./внутр.).',
                '- Храм Атал\'Хаккара (Затонувший храм, 50–60) — Болота Печали.',
                '- Глубины Чёрной горы (48–60) — столица тёмных желез, большой инстанс.',
                '- Пик Чёрной горы: Нижняя часть (55–60) — орки Чернокамня и союзники.',
                '- Пик Чёрной горы: Верхняя часть (58–60) — владения Чёрных драконов.',
                '- Забытый город (55–60) — разрушенный эльфийский город (несколько крыльев).',
                '- Сколоманс (58–60) — некромантская академия Культа Проклятых.',
                '- Стратхольм (58–60) — город Плети (Алая/Нежити стороны).',
            ]],
            [ 'number' => 2, 'title' => 'Огненные Недра и Логово Ониксии', 'lines' => [
                'Первое настоящее испытание чемпионов Азерота началось! Огненные Недра и Логово Ониксии теперь открыты, бросая вызов искателям приключений сразиться с самыми грозными врагами Классики. Только самые сильные герои, прошедшие подземелья Азерота, смогут выстоять перед этими легендарными угрозами.',
                '- Огненные Недра (40 игроков, 60): Люцифрон, Магмадар, Гееннас, Гарр, Барон Геддон, Шаззрах, Сульфурон, Големагг, Майордом Экзекутус, Рагнарос.',
                '- Логово Ониксии (40 игроков, 60): трёхфазная битва, легендарная добыча.',
            ]],
            [ 'number' => 3, 'title' => 'Забытый город, Азурегос, Лорд Каззак (мировые боссы)', 'lines' => [
                'Новая волна испытаний: древние руины, могущественная магия и грозные мировые боссы.',
                '- Забытый город (55–60): Вост./Зап./Сев. (вкл. «Трибьют-ран»), книги и репутации.',
                '- Азурегос (Азшара): синий дракон, ледяная магия, телепорты.',
                '- Лорд Каззак (Выжжённые земли): жестокие удары, проверки ДПС и исполнения.',
            ]],
            [ 'number' => 4, 'title' => 'Логово Крыла Тьмы и Ярмарка Новолуния', 'lines' => [
                'Битва против Чёрного Драконьего Роя на пике Чёрной горы; рядом — Ярмарка Новолуния с бафами и редкостями.',
                '- Логово Крыла Тьмы (40 игроков): Разор, Ваеластраз, Разящий Бич, Огнечрев, Эбонрок, Пламегор, Хромаггус, Нефариан.',
                '- Ярмарка Новолуния: события с картами, усилениями и коллекционными предметами.',
            ]],
            [ 'number' => 5, 'title' => 'Зул\'Гуруб', 'lines' => [
                'Глубоко в Тернистой долине пробуждается древний город Зул’Гуруб; финал — Хаккар Разоритель Душ. Репутация Зандаларов, зачарования, редкие маунты.',
                '- Зул\'Гуруб (20 игроков, 60): 13 боссов, верховные жрецы лоа, Лорд Крови Мандокир, Хаккар Разоритель Душ.',
            ]],
            [ 'number' => 6, 'title' => 'Руины и Храм Ан\'Киража (AQ20 и AQ40)', 'lines' => [
                'Врата Ан’Киража открыты — Империя Кираджи восстала.',
                '- Руины Ан\'Киража (AQ20, 20 игроков): Генерал Раджакс, Моам, Оссириан Неуязвимый; маунты-танки.',
                '- Храм Ан\'Киража (AQ40, 40 игроков): Пророк Скерам, Императоры-близнецы, К’Тун — вершина Классики.',
            ]],
            [ 'number' => 7, 'title' => 'Пылающий Крестовый Поход (старт)', 'lines' => [
                'Тёмный Портал открыт: демоны, орки Скверны и разрушенные цивилизации Запределья. Новые расы: Кровавые эльфы и Дренеи (паладины в Орде, шаманы в Альянсе).',
                '- Цитадель Адского Пламени (60–70): Бастионы Адского Пламени, Кузня Крови, Разрушенные залы.',
                '- Резервуар Кривого Клыка (61–70): Узилище, Нижетопь, Паровое подземелье.',
                '- Аукиндон (64–70): Гробницы маны, Аукенайские гробницы, Сетеккские залы, Лабиринт Теней.',
                '- Пещеры Времени (66–70): Старые предгорья Хилсбрада, Чёрные топи.',
                '- Крепость Бурь (пятёрки, 69–70): Механар, Ботаника, Аркатрац.',
            ]],
            [ 'number' => 8, 'title' => 'Логово Груула, Логово Магтеридона, Сезон Арены 1', 'lines' => [
                'Первые TBC‑рейды и старт PvP‑сезонов.',
                '- Логово Груула (25, 70): Верховный король Маулгар; Груул Убийца Драконов.',
                '- Логово Магтеридона (25, 70): «кубы», адды, рейд‑уроны.',
                '- Сезон Арены 1: 2v2/3v3/5v5, сет Гладиатора.',
            ]],
            [ 'number' => 9, 'title' => 'Каражан', 'lines' => [
                'Башня Медива с шахматами, «оперой», Shade of Aran и Prince Malchezaar — идеальный старт рейд‑прогресса.',
                '- Каражан (10, 70): длинное крыло, много боссов.',
            ]],
            [ 'number' => 10, 'title' => 'Огри’ла и Змеиное святилище', 'lines' => [
                'Небесные вершины Острогорья и глубины Зангартопи.',
                '- Огри’ла: ежедневные задания и награды у просветлённых огров.',
                '- Змеиное святилище (25, 70): финал — Леди Вайш.',
            ]],
            [ 'number' => 11, 'title' => 'Око (Крепость Бурь) и Стражи небес Ша’тари', 'lines' => [
                'Парящая крепость и войны в небесах Тероккара.',
                '- Око (25, 70): многофазный бой с Кель’тасом Солнечным Скитальцем.',
                '- Стражи небес Ша’тари: фракция и ежедневные задания.',
            ]],
            [ 'number' => 12, 'title' => 'Битва за гору Хиджал, Сезон Арены 2, Крылья Пустоты', 'lines' => [
                'Защита истории в Пещерах времени, новая PvP‑лестница и охота за драконами.',
                '- Хиджал (25): волны мобов между боссами.',
                '- Сезон Арены 2: новые награды.',
                '- Крылья Пустоты: репутация и маунты.',
            ]],
            [ 'number' => 13, 'title' => 'Чёрный храм', 'lines' => [
                'Кульминация против Иллидана Ярости Бури.',
                '- Чёрный храм (25, 70): длинный прогресс‑маршрут, Совет Иллидари, Реликварий, Иллидан Ярость Бури.',
            ]],
            [ 'number' => 14, 'title' => 'Зул\'Аман и Сезон Арены 3', 'lines' => [
                'Гонка на время в сердце Призрачных земель.',
                '- Зул\'Аман (10, 70): таймер‑челлендж (медведь Амани).',
                '- Сезон Арены 3: рост конкуренции и наград.',
            ]],
            [ 'number' => 15, 'title' => 'Остров Кель’Данас и Терраса Магистров', 'lines' => [
                'Последний PvE‑хаб TBC и возвращение Кель’таса.',
                '- Остров Кель’Данас: Офензива Расколотого Солнца, ежедневные задания.',
                '- Терраса Магистров (5, 70): возвращение Кель’таса в подземелье.',
            ]],
            [ 'number' => 16, 'title' => 'Плато Солнечного Колодца и Сезон Арены 4', 'lines' => [
                'Финальная битва TBC: плато Солнечного Колодца, где ждёт Кил’джеден; PvP‑сезон 4.',
            ]],
            [ 'number' => 17, 'title' => 'Гнев Короля‑лича (старт)', 'lines' => [
                'Гнев Короля‑Лича: замёрзшие пустоши зовут. Новый класс DK, Нордскол, 5‑ппл подземелья.',
                '- Крепость Утгард (70–72), Нексус (71–73), Азжол‑Неруб (72–74), Ан\'кахет: Старое Королевство (73–75), Крепость Драк\'Тарон (74–76), Аметистовая крепость (75–77), Гундрак (76–78), Чертоги Камня (77–79), Чертоги Молний (78–80), Окулус (79–80), Очищение Стратхольма (79–80).',
            ]],
            [ 'number' => 18, 'title' => 'Героические подземелья, Наксрамас, Обсидиановое святилище, Око Вечности, Хранилище Аркавона, Сезон Арены 5', 'lines' => [
                'Первая волна рейдов WotLK, героические версии 5‑ппл и старт арены.',
                '- Наксрамас (10/25, 80), Обсидиановое святилище (10/25, 80), Око Вечности (10/25, 80), Хранилище Аркавона (10/25, 80).',
            ]],
            [ 'number' => 19, 'title' => 'Ульдуар, Испытание чемпиона, Сезон Арены 6', 'lines' => [
                'Откровения Ульдуара и турнирная подготовка к финальным схваткам.',
                '- Ульдуар (10/25, 80): Хранители, Йогг‑Сарон, «хард‑моды».',
                '- Испытание чемпиона (5, 80): Турнир Серебряного Авангарда.',
                '- Сезон Арены 6.',
            ]],
            [ 'number' => 20, 'title' => 'Логово Ониксии, Испытание крестоносца, Сезон Арены 7', 'lines' => [
                'Возвращение Матери стаи и пик Турнира Серебряного Авангарда.',
                '- Логово Ониксии (уровень 80, 10/25): обновлённая встреча.',
                '- Испытание крестоносца (10/25): Звери Нордскола, Чемпионы, Ануб’арак.',
                '- Сезон Арены 7.',
            ]],
            [ 'number' => 21, 'title' => 'Цитадель Ледяной Короны, подземелья ЦЛК, Сезон Арены 8', 'lines' => [
                'Финальный штурм Плети и решающие PvP‑сражения.',
                '- Цитадель Ледяной Короны (10/25): Лорд Ребрад, Профессор Мерзоцид, Кровавая королева Лана’тель, Синдрагоса, Король‑лич.',
                '- Подземелья ЦЛК (пятёрки): Кузня Душ, Яма Сарона, Залы Отражений.',
                '- Сезон Арены 8.',
            ]],
            [ 'number' => 22, 'title' => 'Рубиновое святилище', 'lines' => [
                'Послесловие к войне с Плетью — Халион и Сумеречный мир в Рубиновом святилище.',
            ]],
        ];

        // Определяем эру для фильтрации на клиенте
        foreach ($phases as &$ph) {
            $title = $ph['title'];
            $era = 'unknown';
            if (stripos($title, 'Классик') !== false) $era = 'classic';
            elseif (stripos($title, 'Пылающий Крестовый Поход') !== false) $era = 'tbc';
            elseif (stripos($title, 'Гнев Короля') !== false) $era = 'wotlk';
            $ph['era'] = $era;

            // Разметка содержимого фазы: первый абзац (lead), прочие абзацы и пункты списка
            $lead = null; $paragraphs = []; $bullets = [];
            foreach ($ph['lines'] as $line) {
                if (strpos($line, '- ') === 0) {
                    $bullets[] = substr($line, 2);
                } else {
                    if ($lead === null) $lead = $line; else $paragraphs[] = $line;
                }
            }
            $ph['lead'] = $lead;
            $ph['paragraphs'] = $paragraphs;
            $ph['bullets'] = $bullets;
        }
        unset($ph);

        renderTemplate('layout.html.php', [
            'contentFile' => 'pages/progression.html.php',
            'pageTitle'   => 'Прогрессия контента',
            'intro'       => $intro,
            'phases'      => $phases,
        ]);
    }
}
