// Design Switcher
(function() {
    'use strict';
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é —Ç–µ–º—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    const savedTheme = localStorage.getItem('siteTheme') || 'classic';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º loader —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–µ–º–∏—É–º —Ç–µ–º—ã
    if (savedTheme === 'premium') {
        showPageLoader();
    }
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é —Ç–µ–º—É
    if (savedTheme === 'premium') {
        enablePremiumTheme();
    }
    
    // –°–æ–∑–¥–∞—Ç—å –∏ –ø–æ–∫–∞–∑–∞—Ç—å loader
    function showPageLoader() {
        const loaderHTML = `
            <div id="page-loader">
                <div class="loader-container">
                    <div class="loader-title">AZEROTH</div>
                    <div class="loader-ring">
                        <div class="loader-symbol">‚öî</div>
                    </div>
                    <div class="loader-text">
                        –ó–ê–ì–†–£–ó–ö–ê<span class="loader-dots"></span>
                    </div>
                    <div class="loader-subtext">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—Ä–µ–º–∏—É–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('afterbegin', loaderHTML);
    }
    
    // –°–∫—Ä—ã—Ç—å loader
    function hidePageLoader() {
        const loader = document.getElementById('page-loader');
        if (loader) {
            loader.classList.add('hidden');
            setTimeout(() => {
                loader.remove();
            }, 500);
        }
    }
    
    // –°–æ–∑–¥–∞—ë–º –∫–Ω–æ–ø–∫—É –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
    function createThemeSwitcher() {
        const switcherHTML = `
            <div class="theme-switcher">
                <button id="theme-toggle" class="theme-toggle-btn" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –¥–∏–∑–∞–π–Ω">
                    <span class="theme-icon">üé®</span>
                    <span class="theme-text"><strong id="current-theme">${savedTheme === 'premium' ? '–ü—Ä–µ–º–∏—É–º' : '–ö–ª–∞—Å—Å–∏–∫'}</strong></span>
                </button>
            </div>
        `;
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ body (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è —Å–ª–µ–≤–∞ —Å–Ω–∏–∑—É)
        document.body.insertAdjacentHTML('beforeend', switcherHTML);
    }
    
    // –í–∫–ª—é—á–∏—Ç—å –ø—Ä–µ–º–∏—É–º-—Ç–µ–º—É
    function enablePremiumTheme() {
        if (!document.getElementById('premium-style')) {
            const link = document.createElement('link');
            link.id = 'premium-style';
            link.rel = 'stylesheet';
            link.href = '/css/premium-style.css?v=' + Date.now(); // –¥–æ–±–∞–≤–ª—è–µ–º –≤–µ—Ä—Å–∏—é –¥–ª—è —Å–±—Ä–æ—Å–∞ –∫—ç—à–∞
            document.head.appendChild(link);
        }
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø—Ä–µ–º–∏—É–º-–∫–ª–∞—Å—Å—ã –∫ —ç–ª–µ–º–µ–Ω—Ç–∞–º
        applyPremiumClasses();
    }
    
    // –û—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–µ–º–∏—É–º-—Ç–µ–º—É
    function disablePremiumTheme() {
        const link = document.getElementById('premium-style');
        if (link) {
            link.remove();
        }
        
        // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ–º–∏—É–º-–∫–ª–∞—Å—Å—ã
        removePremiumClasses();
    }
    
    // –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–µ–º–∏—É–º-–∫–ª–∞—Å—Å—ã
    function applyPremiumClasses() {
        // –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
        const indexBody = document.querySelector('.body');
        if (indexBody && window.location.pathname === '/' || window.location.pathname === '/index') {
            const h1 = indexBody.querySelector('h1');
            if (h1 && !h1.closest('.welcome-block')) {
                const welcomeDiv = document.createElement('div');
                welcomeDiv.className = 'welcome-block';
                h1.parentNode.insertBefore(welcomeDiv, h1);
                welcomeDiv.appendChild(h1);
            }
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º pt –±–ª–æ–∫–∏ –≤ info-alert
            indexBody.querySelectorAll('.pt').forEach(el => {
                if (!el.classList.contains('info-alert')) {
                    el.classList.add('info-alert');
                }
            });
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º event –±–ª–æ–∫ –≤ community-box
            const eventBlock = indexBody.querySelector('.event');
            if (eventBlock && !eventBlock.classList.contains('community-box')) {
                eventBlock.classList.add('community-box');
            }
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º section-sep –≤ feature-item
            indexBody.querySelectorAll('.section-sep').forEach(el => {
                if (!el.classList.contains('feature-item')) {
                    el.classList.add('feature-item');
                }
            });
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º iLegendary –∫–Ω–æ–ø–∫–∏ –≤ btn-premium
            indexBody.querySelectorAll('.iLegendary').forEach(el => {
                if (!el.classList.contains('btn-premium')) {
                    el.classList.add('btn-premium');
                }
            });
        }
        
        // –õ–µ–≤—ã–π –±–ª–æ–∫ (–º–µ–Ω—é)
        const leftBlock = document.querySelector('.test3 .body');
        if (leftBlock && !leftBlock.classList.contains('menu-block')) {
            leftBlock.classList.add('menu-block');
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º info –≤ menu-item
            leftBlock.querySelectorAll('.info').forEach(el => {
                if (!el.classList.contains('menu-item')) {
                    el.classList.add('menu-item');
                }
            });
        }
        
        // –ü—Ä–∞–≤—ã–π –±–ª–æ–∫ (—Å—Ç–∞—Ç—É—Å)
        const rightBlock = document.querySelector('.test2 .body');
        if (rightBlock && !rightBlock.classList.contains('status-block')) {
            rightBlock.classList.add('status-block');
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º yellow –≤ status-item
            rightBlock.querySelectorAll('.yellow').forEach(el => {
                if (!el.classList.contains('status-item')) {
                    el.classList.add('status-item');
                }
            });
        }
    }
    
    // –£–±—Ä–∞—Ç—å –ø—Ä–µ–º–∏—É–º-–∫–ª–∞—Å—Å—ã
    function removePremiumClasses() {
        document.querySelectorAll('.welcome-block, .info-alert, .community-box, .feature-item, .btn-premium, .menu-block, .menu-item, .status-block, .status-item')
            .forEach(el => {
                el.classList.remove('welcome-block', 'info-alert', 'community-box', 'feature-item', 'btn-premium', 'menu-block', 'menu-item', 'status-block', 'status-item');
            });
    }
    
    // –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É
    function toggleTheme() {
        const currentTheme = localStorage.getItem('siteTheme') || 'classic';
        const newTheme = currentTheme === 'classic' ? 'premium' : 'classic';
        
        localStorage.setItem('siteTheme', newTheme);
        
        if (newTheme === 'premium') {
            enablePremiumTheme();
        } else {
            disablePremiumTheme();
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ –∫–Ω–æ–ø–∫–µ
        const themeText = document.getElementById('current-theme');
        if (themeText) {
            themeText.textContent = newTheme === 'premium' ? '–ü—Ä–µ–º–∏—É–º' : '–ö–ª–∞—Å—Å–∏–∫';
        }
        
        // –ü–ª–∞–≤–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
        document.body.style.opacity = '0';
        setTimeout(() => {
            location.reload();
        }, 200);
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', function() {
        createThemeSwitcher();
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
        const toggleBtn = document.getElementById('theme-toggle');
        if (toggleBtn) {
            toggleBtn.addEventListener('click', toggleTheme);
        }
        
        // –°–∫—Ä—ã–≤–∞–µ–º loader –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–µ–º–∏—É–º —Ç–µ–º—ã)
        if (savedTheme === 'premium') {
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞
            setTimeout(() => {
                hidePageLoader();
            }, 800);
        }
    });
    
    // –°–∫—Ä—ã–≤–∞–µ–º loader –ø—Ä–∏ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –≤—Å–µ—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
    window.addEventListener('load', function() {
        if (savedTheme === 'premium') {
            setTimeout(() => {
                hidePageLoader();
            }, 300);
        }
    });
})();
